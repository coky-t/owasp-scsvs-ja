# S4. アクセス制御と認証 (Access Control and Authentication)

## 管理目標
堅牢なアクセス制御と認証メカニズムを確立し、認可されたエンティティのみがスマートコントラクト内での機密性の高い操作を実行できるようにします。これには、ロールベースのアクセス制御 (RBAC)、安全な認可メカニズム、分散型アイデンティティ管理の実装を含みます。

## S4.1 ロールベースのアクセス制御 (RBAC) (Role-Based Access Control (RBAC))

### 管理目標
ロールベースのアクセス制御を実装してパーミッションを管理し、認可されたユーザーのみが特定の機能にアクセスできるようにします。これには、アイデンティティの検証、最小権限の原則の適用、適切なアクセス制御の実施の確保などを含みます。

### S4.1.A マルチ署名スキーム (Multi-Signature Schemes)

| 参照コード   | 要件                                                                        | L1 | L2 | L3 | SWE |
| ------------ | --------------------------------------------------------------------------- | -- | -- | -- | --- |
| S4.1.A1      | すべての関数の visibility 修飾子が適切であり、内部関数の不必要な公開を防いでいることを確認します。 |    | ✓  | ✓  |     |

### S4.1.B アイデンティティ検証 (Identity Verification)

| 参照コード   | 要件                                                                        | L1 | L2 | L3 | SWE |
| ------------ | --------------------------------------------------------------------------- | -- | -- | -- | --- |
| S4.1.B1      | 予期しないアドレスが、特にこれらのアドレスが同じプロトコル内のコントラクトを参照している場合に、意図しない動作を引き起こさないことを検証します。 |    | ✓  | ✓  |     |
| S4.1.B2      | ecrecover などの関数がすべての潜在的な null アドレスを適切に処理し、予期しない ecrecover 出力から生じる脆弱性を避けていることを検証します。 |    | ✓  | ✓  |     |

### S4.1.C 最小権限の原則 (Least Privilege Principle)

| 参照コード   | 要件                                                                        | L1 | L2 | L3 | SWE |
| ------------ | --------------------------------------------------------------------------- | -- | -- | -- | --- |
| S4.1.C1      | 認可には tx.origin ではなく msg.sender を使用して、悪意のあるコントラクトによる潜在的な悪用を回避します。require(tx.origin == msg.sender) などのチェックを含めて、送信者が EOA であることを確認します。 |    | ✓  | ✓  |     |
| S4.1.C2      | 特定のアドレスがトークンの受信をブロックまたは制限している可能性があります (LUSD など)。アドレス制限が適切に管理され、検証されていることを確認します。 |    | ✓  | ✓  |     |
| S4.1.C3      | Guard のフック (checkTransaction(), checkAfterExecution() など) が実行され、重要なセキュリティチェックを実施することを確認します。 |    | ✓  | ✓  |     |
| S4.1.C4      | アクセス制御が正しく実行され、誰が特定の機能を使用できるかを決定し、認可されていない変更や引き出しを回避していることを確認します。 |    | ✓  | ✓  |     |


## S4.2 認可メカニズム (Authorization Mechanisms)

### 管理目標
安全な認可メカニズムを実装して、重要な機能や機密性の高い操作を保護し、認可されたエンティティのみがこれらのアクションを実行できるようにします。

### S4.2.A 重要な機能への安全なアクセス (Secure Access to Critical Functions)

| 参照コード   | 要件                                                                        | L1 | L2 | L3 | SWE |
| ------------ | --------------------------------------------------------------------------- | -- | -- | -- | --- |
| S4.2.A1      | コントラクトは認可に tx.origin ではなく msg.sender を使用して、正当なユーザーからの呼び出しを転送するコントラクトに関連する脆弱性を回避していることを検証します。 |    | ✓  | ✓  |     |
| S4.2.A2      | コントラクト状態を変更したり、機密性の高い操作を実行する機能に対して適切なアクセス制御を実装して検証し、認可されていないアクセスを防いでいる。 |    | ✓  | ✓  |     |

### S4.2.B 期限付きパーミッション (Timed Permissions)

| 参照コード   | 要件                                                                        | L1 | L2 | L3 | SWE |
| ------------ | --------------------------------------------------------------------------- | -- | -- | -- | --- |
| S4.2.B1      | Merkle ツリーを使用する場合、msg.sender バリデーションが適切に実装され、セキュリティを維持し、認可されていないアクセスを防いでいることを確認します。 |    | ✓  | ✓  |     |
| S4.2.B2      | ホワイトリストを使用して、特定のアドレスセットへのインタラクションを制限し、悪意のあるアクターに対するセキュリティを強化します。 |    | ✓  | ✓  |     |
| S4.2.B3      | コントラクト状態を変更したり、機密性の高い操作にアクセスする関数に、適切なアクセス制御が実装されていることを確認します。 |    | ✓  | ✓  |     |


## S4.3 分散型アイデンティティ (Decentralized Identity)

### 管理目標
分散型アイデンティティソリューションを導入し、ユーザーのプライバシーを維持しながら、安全で信頼性の高いアイデンティティ検証と管理を実現します。

### S4.3.A 分散識別子 (DID) (Decentralized Identifiers (DIDs))

| 参照コード   | 要件                                                                        | L1 | L2 | L3 | SWE |
| ------------ | --------------------------------------------------------------------------- | -- | -- | -- | --- |
| S4.3.A1      | DID を処理するためのスマートコントラクトが、分散型アイデンティティ管理の最新の標準とベストプラクティスに準拠していることを検証します。 |    | ✓  | ✓  |     |
| S4.3.A2      | DID 管理コントラクトには、認可されていない変更を防ぎ、DID レコードの完全性を確保するためのメカニズムを含むことを確認します。 |    | ✓  | ✓  |     |
| S4.3.A3      | スマートコントラクトによって管理される DID ドキュメントが安全に保存され、分散化された方法で検索できることをチェックします。 |    | ✓  | ✓  |     |
| S4.3.A4      | スマートコントラクトが信頼性の高い DID 解決をサポートし、競合と更新を処理するメカニズムを含むことを検証します。 |    | ✓  | ✓  |     |
| S4.3.A5      | スマートコントラクトがそのライフサイクル全体を通じて DID 関連情報のプライバシーと機密性を維持していることを確認します。 |    | ✓  | ✓  |     |

### S4.3.B 検証可能なクレデンシャル (Verifiable Credentials)

| 参照コード   | 要件                                                                        | L1 | L2 | L3 | SWE |
| ------------ | --------------------------------------------------------------------------- | -- | -- | -- | --- |
| S4.3.B1      | Verify that the smart contract manages verifiable credentials in a way that ensures their authenticity and integrity through cryptographic proofs. |    | ✓  | ✓  |     |
| S4.3.B2      | Ensure that the issuance process of verifiable credentials by the smart contract includes proper identity verification and validation procedures. |    | ✓  | ✓  |     |
| S4.3.B3      | Check that the smart contract supports cryptographic proofs to verify the validity of credentials without disclosing sensitive information. |    | ✓  | ✓  |     |
| S4.3.B4      | Verify that the smart contract includes a secure process for revoking verifiable credentials when necessary. |    | ✓  | ✓  |     |
| S4.3.B5      | Ensure that the smart contract’s handling of verifiable credentials complies with relevant standards and best practices for secure credential management. |    | ✓  | ✓  |     |
